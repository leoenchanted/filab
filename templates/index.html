<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>PRO FILM LAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              black: "#000000",
              panel: "#111",
              border: "#222",
              accent: "#ff9500",
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="bg-black text-gray-200 h-screen flex flex-col overflow-hidden select-none touch-none"
  >
    <!-- 1. 顶部栏 -->
    <nav
      class="h-12 border-b border-border bg-panel/90 flex items-center justify-between px-4 shrink-0 z-50"
    >
      <div class="font-bold tracking-widest text-white text-xs">
        FILM LAB <span class="text-[9px] text-gray-600">v12.0</span>
      </div>

      <!-- 右侧区域 -->
      <div class="flex items-center gap-4">
        <!-- === 唯一访客计数器 (新增) === -->
        <div class="text-[9px] font-mono tracking-wider text-gray-500">
          VISITORS
          <span class="text-accent font-bold text-[10px] ml-1"
            >{{ total_visitors }}</span
          >
        </div>
        <!-- === 结束新增 === -->

        <div
          id="fileInfo"
          class="hidden items-center gap-3 text-[10px] font-mono bg-black/50 px-3 py-1 rounded-full border border-white/5"
        >
          <span id="stat_in" class="text-gray-400"></span>
          <span class="text-gray-600">→</span>
          <span id="stat_out" class="text-accent"></span>
          <div class="pl-2 border-l border-gray-700 ml-2 text-gray-500">
            <span id="stat_time" class="text-gray-300">--</span>s
          </div>
        </div>

        <div class="text-[10px] text-gray-600 flex items-center gap-2">
          <div
            id="statusDot"
            class="w-1.5 h-1.5 rounded-full bg-gray-600"
          ></div>
        </div>
      </div>
    </nav>

    <!-- 2. 主视口 -->
    <main
      class="flex-1 relative flex items-center justify-center bg-black overflow-hidden group"
    >
      <div id="emptyState" class="text-center transition-opacity duration-300">
        <button
          onclick="document.getElementById('fileInput').click()"
          class="w-24 h-24 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center border border-white/10 transition-all mx-auto mb-4 hover:border-accent/50"
        >
          <svg
            class="w-8 h-8 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M12 4v16m8-8H4"
            />
          </svg>
        </button>
        <p
          class="text-[10px] text-gray-600 font-mono tracking-widest uppercase"
        >
          Tap to Open
        </p>
      </div>

      <canvas
        id="glCanvas"
        class="max-w-full max-h-full object-contain opacity-0 transition-opacity duration-500 shadow-2xl"
      ></canvas>

      <div
        id="progressModal"
        class="absolute inset-0 bg-black/90 backdrop-blur-md z-50 hidden flex-col items-center justify-center"
      >
        <div class="w-64">
          <div
            class="flex justify-between text-[10px] font-bold text-gray-400 mb-2 uppercase tracking-wider"
          >
            <span id="progressStep">Processing</span>
            <span id="progressPercent" class="text-white">0%</span>
          </div>
          <div class="h-0.5 bg-gray-800 w-full">
            <div
              id="progressBar"
              class="h-full bg-accent transition-all duration-100 ease-linear w-0 shadow-[0_0_10px_rgba(255,149,0,0.5)]"
            ></div>
          </div>
        </div>
      </div>

      <!-- 浮动工具栏 -->
      <div
        id="floatingTools"
        class="absolute top-4 right-4 flex gap-3 opacity-0 pointer-events-none transition-opacity duration-300 z-40"
      >
        <!-- 对比 -->
        <button
          id="compareBtn"
          class="w-10 h-10 rounded-full bg-black/60 backdrop-blur border border-white/20 flex items-center justify-center hover:bg-white hover:text-black transition-all shadow-xl active:scale-90"
          title="Hold to Compare"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
            />
          </svg>
        </button>

        <!-- OPEN (更换图片) -->
        <button
          onclick="document.getElementById('fileInput').click()"
          class="h-10 px-4 rounded-full bg-white/10 backdrop-blur border border-white/20 text-white font-bold text-[10px] flex items-center gap-2 hover:bg-white/20 transition-all shadow-xl active:scale-95 tracking-wider"
        >
          OPEN
        </button>

        <!-- SAVE -->
        <button
          id="downloadBtn"
          onclick="app.download()"
          class="h-10 px-6 rounded-full bg-white text-black font-bold text-[10px] flex items-center gap-2 hover:bg-gray-200 transition-all shadow-xl active:scale-95 tracking-wider"
        >
          SAVE
        </button>
      </div>

      <div
        id="originalLabel"
        class="absolute top-4 left-4 bg-accent text-black text-[10px] font-black px-2 py-0.5 rounded opacity-0 transition-opacity z-40 tracking-wider"
      >
        ORIGINAL
      </div>
    </main>

    <!-- 3. 底部控制台 (修复结构) -->
    <footer
      class="bg-panel border-t border-border shrink-0 flex flex-col z-40 h-[280px]"
    >
      <!-- 容器：用于实现绝对定位的平滑切换 -->
      <div class="panel-container flex-1 relative overflow-hidden">
        <!-- PANEL 1: PRESETS (初始 active) -->
        <div
          id="panelPresets"
          class="control-panel active flex flex-col h-full absolute top-0 left-0 w-full bg-panel"
        >
          <div
            class="px-6 py-3 flex gap-6 text-[10px] font-bold text-gray-600 tracking-wider overflow-x-auto scrollbar-hide shrink-0"
            id="brandTabs"
          ></div>
          <div
            class="flex-1 overflow-x-auto scrollbar-hide flex items-center px-6 gap-5 pb-2"
            id="filmStrip"
          ></div>
          <div
            class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-panel to-transparent pointer-events-none"
          ></div>
        </div>

        <!-- PANEL 2: ADJUST (初始 hidden-panel) -->
        <div
          id="panelAdjust"
          class="control-panel hidden-panel flex flex-col h-full absolute top-0 left-0 w-full bg-panel"
        >
          <!-- Adjust Tabs -->
          <div
            class="h-12 border-b border-border flex items-center px-4 gap-2 overflow-x-auto scrollbar-hide shrink-0 bg-black/20"
          >
            <button
              onclick="app.switchAdjustCat('color')"
              class="adjust-tab active"
              id="cat_color"
            >
              Color
            </button>
            <button
              onclick="app.switchAdjustCat('light')"
              class="adjust-tab"
              id="cat_light"
            >
              Light
            </button>
            <button
              onclick="app.switchAdjustCat('tone')"
              class="adjust-tab"
              id="cat_tone"
            >
              Tone
            </button>
            <button
              onclick="app.switchAdjustCat('effects')"
              class="adjust-tab"
              id="cat_effects"
            >
              Effects
            </button>
          </div>

          <!-- Sliders -->
          <div class="flex-1 overflow-y-auto p-6 scrollbar-hide">
            <!-- Color -->
            <div id="group_color" class="space-y-4">
              <div class="slider-container">
                <span class="slider-label">TEMP</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="temp"
                /><span class="slider-value" id="val_temp">0</span>
              </div>
              <div class="slider-container">
                <span class="slider-label">TINT</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="tint"
                /><span class="slider-value" id="val_tint">0</span>
              </div>
              <div class="slider-container">
                <span class="slider-label">SAT</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="saturation"
                /><span class="slider-value" id="val_saturation">0</span>
              </div>
            </div>
            <!-- Light -->
            <div id="group_light" class="space-y-4 hidden">
              <div class="slider-container">
                <span class="slider-label">EXP</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="exposure"
                /><span class="slider-value" id="val_exposure">0</span>
              </div>
              <div class="slider-container">
                <span class="slider-label">CON</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="contrast"
                /><span class="slider-value" id="val_contrast">0</span>
              </div>
            </div>
            <!-- Tone -->
            <div id="group_tone" class="space-y-4 hidden">
              <div class="slider-container">
                <span class="slider-label">HIGH</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="highlights"
                /><span class="slider-value" id="val_highlights">0</span>
              </div>
              <div class="slider-container">
                <span class="slider-label">SHAD</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="shadows"
                /><span class="slider-value" id="val_shadows">0</span>
              </div>
              <div class="slider-container">
                <span class="slider-label">WHITE</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="whites"
                /><span class="slider-value" id="val_whites">0</span>
              </div>
              <div class="slider-container">
                <span class="slider-label">BLACK</span
                ><input
                  type="range"
                  min="-100"
                  max="100"
                  value="0"
                  data-param="blacks"
                /><span class="slider-value" id="val_blacks">0</span>
              </div>
            </div>
            <!-- Effects -->
            <div id="group_effects" class="space-y-4 hidden">
              <div class="slider-container">
                <span class="slider-label text-accent">INTENSITY</span
                ><input
                  type="range"
                  min="0"
                  max="100"
                  value="100"
                  data-param="opacity"
                  class="accent-slider"
                /><span class="slider-value text-accent" id="val_opacity"
                  >100</span
                >
              </div>
              <div class="slider-container">
                <span class="slider-label">GRAIN</span
                ><input
                  type="range"
                  min="0"
                  max="100"
                  value="0"
                  data-param="grain"
                /><span class="slider-value" id="val_grain">0</span>
              </div>
              <div class="slider-container">
                <span class="slider-label">VIGNETTE</span
                ><input
                  type="range"
                  min="0"
                  max="100"
                  value="0"
                  data-param="vignette"
                /><span class="slider-value" id="val_vignette">0</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 底部 Mode Switcher -->
      <div
        class="h-10 border-t border-border flex items-center justify-center gap-1 bg-black relative shrink-0"
      >
        <div class="absolute top-0 left-0 w-full h-full flex">
          <button
            onclick="app.switchMode('presets')"
            id="modePresets"
            class="flex-1 z-10 text-[10px] font-bold text-white transition-colors tracking-widest uppercase"
          >
            FILM
          </button>
          <button
            onclick="app.switchMode('adjust')"
            id="modeAdjust"
            class="flex-1 z-10 text-[10px] font-bold text-gray-600 transition-colors tracking-widest uppercase"
          >
            ADJUST
          </button>
        </div>
        <!-- 白条指示器 -->
        <div
          id="tabIndicator"
          class="absolute top-0 left-0 w-1/2 h-[2px] bg-white transition-transform duration-300 ease-out"
        ></div>
      </div>
    </footer>

    <input type="file" id="fileInput" class="hidden" accept="image/*" />
    <script src="/static/js/webgl.js"></script>
    <script src="/static/js/main.js"></script>
  </body>
</html>
